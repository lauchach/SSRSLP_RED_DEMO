// let msg = {
//     "userId": "U224917cde772137b14a3ebbf596508d0",
//     "payload": {
//         "json": {
//             "response": [
//                 "好的，您稍等一下，我將為您比較 Siri Place Bang Yai 和 Siri Place Bangna-Suvarnabhumi 計畫。\n\n"
//             ],
//             "tool": [
//                 {
//                     "action": [
//                         "compare"
//                     ],
//                     "subaction": [
//                         "project"
//                     ],
//                     "projectName": [
//                         "สิริ เพลส บางใหญ่, สิริ เพลส บางนา - สุวรรณภูมิ"
//                     ],
//                     "locale": [
//                         "CN"
//                     ]
//                 }
//             ]
//         }
//     },
//     "_unify_bot": {
//         "transactionId": "11802953442857587",
//         "networkId": "63775ba160552c294703f6be",
//         "user": {
//             "id": "6694b61eea61e1830353fb91",
//             "networkId": "63775ba160552c294703f6be",
//             "channelId": "2005830043",
//             "userId": "U224917cde772137b14a3ebbf596508d0",
//             "createdAt": "2024-07-15T05:39:42.791Z",
//             "updatedAt": "2024-07-17T08:29:01.950Z",
//             "info": {
//                 "displayName": "BENZ",
//                 "imageUrl": "https://sprofile.line-scdn.net/0hIZteSH_cFnVZHAZwr4BoCilMFR96bU9nIi9aFW5IH0ZkewUqIHwJG2oVTxdtKQYiJSpcQ2wbTU1VD2ETR0rqQV4sS0RlKFghdHtckQ",
//                 "status": "",
//                 "metadata": {
//                     "member_id": "1234",
//                     "name": "Quiw",
//                     "age": "20",
//                     "phone": "087xxxx876"
//                 }
//             }
//         },
//         "incomingMessage": {
//             "channelId": "2005830043",
//             "networkId": "63775ba160552c294703f6be",
//             "metadata": {
//                 "replyToken": true
//             },
//             "type": "text",
//             "isActive": true,
//             "userId": "U224917cde772137b14a3ebbf596508d0",
//             "payload": "比較 Siri Place Bang Yai 和 Siri Place Bangna-Suvarnabhumi 計畫。",
//             "timestamp": 1721204940997
//         },
//         "channel": {
//             "id": "6690df21f0dddaf3c7e33fa9",
//             "channelId": "2005830043",
//             "networkId": "63775ba160552c294703f6be",
//             "name": "Sansiri_Demo",
//             "type": "LINE",
//             "config": {
//                 "token": "CrYJmlk+7ebRaJ9VoBhliVVYAZoP5OI9GEDYTmoiyAbvLBCc8XXAi5OnAsOdk9uj245ISIRiitS8+TS2pHptnfHnnSUCSA7oJ2RPqpwLqpnJCXKhjRFZPr/oc3OzKsCnkhdgDd4t7KbmofvhT6UmuwdB04t89/1O/w1cDnyilFU=",
//                 "secret": "fc65b1ce84aba14115bb2e5ab00264d0",
//                 "webhookUrl": null,
//                 "apiKey": null,
//                 "metadata": null
//             }
//         },
//         "conversation": {
//             "id": "6694b61fea61e1830353fb92",
//             "conversationId": "U224917cde772137b14a3ebbf596508d0",
//             "networkId": "63775ba160552c294703f6be",
//             "channelId": "2005830043",
//             "intent": null,
//             "entities": []
//         },
//         "fallbackAction": {
//             "action": "@66399f2ab5fdff68ee40/action_gpt_ssr",
//             "metadata": {
//                 "type": "text",
//                 "fallback": "fallback",
//                 "flag": "update-v1"
//             }
//         },
//         "action": {
//             "action": "@66399f2ab5fdff68ee40/action_gpt_ssr",
//             "metadata": {
//                 "type": "text",
//                 "fallback": "fallback",
//                 "flag": "update-v1"
//             }
//         },
//         "metadata": {
//             "response_gpt": "好的，您稍等一下，我將為您比較 Siri Place Bang Yai 和 Siri Place Bangna-Suvarnabhumi 計畫。\n\n",
//             "information": [
//                 {
//                     "projectFullName": "Siri Place Bangyai",
//                     "minPrice": "2.39",
//                     "image": "https://assets.sansiri.com/o77site/project-image-siri-place-bangyai-landscape-935x745.jpg",
//                     "url": "https://www.sansiri.com/townhome/siri-place-bangyai/th/",
//                     "projectId": 478,
//                     "facility": [
//                         {
//                             "facilityProjectCategoryId": 1,
//                             "facilityCategory": "คลับเฮาส์"
//                         },
//                         {
//                             "facilityProjectCategoryId": 2,
//                             "facilityCategory": "สระว่ายน้ำระบบน้ำเกลือ"
//                         },
//                         {
//                             "facilityProjectCategoryId": 3,
//                             "facilityCategory": "ห้องออกกำลังกาย"
//                         },
//                         {
//                             "facilityProjectCategoryId": 6,
//                             "facilityCategory": "เจ้าหน้าที่รักษาความปลอดภัย ตลอด 24 ชั่วโมง"
//                         },
//                         {
//                             "facilityProjectCategoryId": 59,
//                             "facilityCategory": "สนามบาสเกตบอล"
//                         },
//                         {
//                             "facilityProjectCategoryId": 65,
//                             "facilityCategory": "Educational Playground​"
//                         }
//                     ],
//                     "totalUnit": "299",
//                     "location": "Bang Yai"
//                 },
//                 {
//                     "projectFullName": "Siri Place Bangna-Suvarnabhumi",
//                     "minPrice": "2.29",
//                     "image": "https://assets.sansiri.com/o77site/sansiri-project-siri-place-bangna-suvarnabhumi-landscape.jpg",
//                     "url": "https://www.sansiri.com/townhome/siri-place-bangna-suvarnabhumi/th/",
//                     "projectId": 530,
//                     "facility": [
//                         {
//                             "facilityProjectCategoryId": 1,
//                             "facilityCategory": "คลับเฮาส์"
//                         },
//                         {
//                             "facilityProjectCategoryId": 2,
//                             "facilityCategory": "สระว่ายน้ำระบบน้ำเกลือ"
//                         },
//                         {
//                             "facilityProjectCategoryId": 3,
//                             "facilityCategory": "ห้องออกกำลังกาย"
//                         },
//                         {
//                             "facilityProjectCategoryId": 23,
//                             "facilityCategory": "สวนส่วนกลาง "
//                         },
//                         {
//                             "facilityProjectCategoryId": 32,
//                             "facilityCategory": "ประตูทางเข้า-ออก 2 ชั้น"
//                         }
//                     ],
//                     "totalUnit": "285",
//                     "location": "Suvarnabhumi"
//                 }
//             ],
//             "lang": "CN"
//         }
//     },
//     "_msgid": "52e381b3efb23dfa",
//     "url": "https://api.amitysolutions.com/api/v1/messages/text?sync=true",
//     "headers": {
//         "server": "nginx/1.18.0 (Ubuntu)",
//         "date": "Wed, 17 Jul 2024 08:29:10 GMT",
//         "content-type": "application/json; charset=utf-8",
//         "content-length": "232925",
//         "connection": "keep-alive",
//         "x-powered-by": "Express",
//         "etag": "W/\"38ddd-KxuVW2SmeMVpHA547bONBmli/FU\"",
//         "vary": "Accept-Encoding",
//         "x-node-red-request-node": "6cdeec42"
//     },
//     "statusCode": 201,
//     "responseUrl": "https://api.amitysolutions.com/api/v1/messages/text?sync=true",
//     "redirectList": [],
//     "retry": 0,
//     "type": "flow",
//     "split": [
//         "好的，您稍等一下，我將為您比較 Siri Place Bang Yai 和 Siri Place Bangna-Suvarnabhumi 計畫。\n\n",
//         "\n    <action>compare</action>\n    <subaction>project</subaction>\n    <projectName>สิริ เพลส บางใหญ่, สิริ เพลส บางนา - สุวรรณภูมิ</projectName>\n    <locale>CN</locale>\n</tool>"
//     ],
//     "actionName": "compare"
// }
// node.warn(faciciltyDedup);
let contents = []
let faciciltyConcat = []
const configText = {
    TH: { 
            startPrice: "ราคาเริ่มต้น", endStartPrice: "ล้านบาท",
            location: "ทำเลที่ตั้่ง",
            units: "จำนวนยูนิต",
            unit: "ยูนิต",
            facility: "สิ่งอํานวยความสะดวกภายในโครงการ",
            detile: "รายละเอียดเพิ่มเติม",
            facilityProjectCategoryId: {
                1: "คลับเฮาส์",
                2: "สระว่ายน้ำระบบน้ำเกลือ",
                3: "ห้องออกกำลังกาย",
                6: "เจ้าหน้าที่รักษาความปลอดภัย ตลอด 24 ชั่วโมง",
                8: "กล้องวงจรปิดตลอด 24 ชั่วโมง",
                11: "อินเตอร์เน็ตไร้สาย internet",
                19: "สระว่ายน้ำ pool",
                20: "สระเด็ก pool_kid",
                23: "สวนส่วนกลาง park",
                24: "สนามเด็กเล่น playground",
                32: "ประตูทางเข้า-ออก 2 ชั้น",
                59: "สนามบาสเกตบอล",
                62: "Co-Working Space",
                65: "Educational Playground​",
                83: "Sansiri Backyard",
            }
        },
    EN: { 
            startPrice: "Start", endStartPrice: "M",
            location: "Location",
            units: "Units",
            unit: "Unit",
            facility: "Facility",
            detile: "detile",
            facilityProjectCategoryId: {
                1: "Club House",
                2: "Swimming Pool",
                3: "Fitness",
                6: "Security Guards 24 HR",
                8: "SecurityCam 24 HR",
                11: "Internet",
                19: "Pool",
                20: "Pool Kid",
                23: "Park",
                24: "Playground",
                32: "Double Door Entry",
                59: "Basketball court",
                62: "Co-Working Space",
                65: "Educational Playground​",
                83: "Sansiri Backyard",
            }
        },
    CN: {
            startPrice: "Start", endStartPrice: "M",
            location: "Location",
            units: "Units",
            unit: "Unit",
            facility: "Facility",
            detile: "detile",
            facilityProjectCategoryId: {
                1: "Club House",
                2: "Swimming Pool",
                3: "Fitness",
                6: "Security Guards 24 HR",
                8: "SecurityCam 24 HR",
                11: "Internet",
                19: "Pool",
                20: "Pool Kid",
                23: "Park",
                24: "Playground",
                32: "Double Door Entry",
                59: "Basketball court",
                62: "Co-Working Space",
                65: "Educational Playground​",
                83: "Sansiri Backyard",
                
            }
        },
}

const lang = msg.payload?.json?.tool[0]?.locale[0] || "TH"

msg._unify_bot.metadata.information.forEach(function(element) {
    faciciltyConcat = faciciltyConcat.concat(element.facility)
});
const dedupArray = (arr) => {
    const map = new Map();
    return arr.filter(item => {
        if (!map.has(item.facilityProjectCategoryId)) {
            map.set(item.facilityProjectCategoryId, true);
            return true;
        }
        return false;
    });
};

let faciciltyDedup = dedupArray(faciciltyConcat);
node.warn(faciciltyDedup);
let checkedFacility = []
msg._unify_bot.metadata.information.forEach(function (element, index) {
    let bubble = {
        "type": "bubble",
        "size": "giga",
        "body": {
            "type": "box",
            "layout": "vertical",
            "contents": [
            {
                "type": "box",
                "layout": "horizontal",
                "contents": [
                {
                    "type": "box",
                    "layout": "vertical",
                    "contents": [
                    {
                        "type": "image",
                        "url": "https://assets.sansiri.com/o77site/siri-place-charan-pinklao-townhouse-portrait-810x890.jpg",
                        "aspectRatio": "1:1",
                        "size": "full",
                        "aspectMode": "cover"
                    }
                    ]
                },
                {
                    "type": "box",
                    "layout": "vertical",
                    "contents": [
                    {
                        "type": "image",
                        "url": "https://assets.sansiri.com/o77site/thumbnail-image-Siri-Place-Don-Mueng-Songprapha-810x890.jpg",
                        "aspectRatio": "1:1",
                        "aspectMode": "cover",
                        "size": "full"
                    }
                    ]
                }
                ]
            },
            {
                "type": "box",
                "layout": "horizontal",
                "contents": [
                {
                    "type": "box",
                    "layout": "vertical",
                    "contents": [
                    {
                        "type": "text",
                        "text": "สิริ เพลส จรัญฯ - ปิ่นเกล้า",
                        "size": "md",
                        "wrap": true,
                        "align": "center",
                        "weight": "bold"
                    }
                    ]
                },
                {
                    "type": "box",
                    "layout": "vertical",
                    "contents": [
                    {
                        "type": "text",
                        "text": "สิริ เพลส ดอนเมือง - สรงประภา",
                        "size": "md",
                        "wrap": true,
                        "align": "center",
                        "weight": "bold"
                    }
                    ]
                }
                ],
                "alignItems": "center",
                "justifyContent": "center",
                "paddingTop": "10px",
                "paddingBottom": "10px"
            },
            {
                "type": "separator"
            },
            {
                "type": "box",
                "layout": "horizontal",
                "contents": [
                {
                    "type": "box",
                    "layout": "vertical",
                    "contents": [
                    {
                        "type": "text",
                        "contents": [
                        {
                            "type": "span",
                            "text": `${configText[lang].startPrice} `
                        },
                        {
                            "type": "span",
                            "text": "3.59",
                            "weight": "bold",
                            "color": "#FB2676"
                        },
                        {
                            "type": "span",
                            "text": ` ${configText[lang].endStartPrice}`
                        }
                        ]
                    }
                    ],
                    "margin": "none",
                    "paddingAll": "md",
                    "alignItems": "center",
                    "justifyContent": "center"
                },
                {
                    "type": "separator"
                },
                {
                    "type": "box",
                    "layout": "vertical",
                    "contents": [
                    {
                        "type": "text",
                        "contents": [
                        {
                            "type": "span",
                            "text": `${configText[lang].startPrice} `
                        },
                        {
                            "type": "span",
                            "text": " 2.99",
                            "weight": "bold",
                            "color": "#FB2676"
                        },
                        {
                            "type": "span",
                            "text": ` ${configText[lang].endStartPrice}`
                        }
                    ]
                    }
                    ],
                    "paddingAll": "md",
                    "justifyContent": "center",
                    "alignItems": "center"
                }
                ],
                "borderColor": "#DBDBDB",
                "margin": "xs"
            },
            {
                "type": "box",
                "layout": "vertical",
                "contents": [
                {
                    "type": "text",
                    "text": `${configText[lang].location}`,
                    "align": "center",
                    "color": "#FFFFFF"
                }
                ],
                "backgroundColor": "#FB2676",
                "paddingAll": "md"
            },
            {
                "type": "box",
                "layout": "horizontal",
                "contents": [
                {
                    "type": "box",
                    "layout": "vertical",
                    "contents": [
                    {
                        "type": "text",
                        "text": "จรัญสนิทวงศ์",
                        "align": "center"
                    }
                    ],
                    "paddingAll": "md",
                    "borderWidth": "light"
                },
                {
                    "type": "separator"
                },
                {
                    "type": "box",
                    "layout": "vertical",
                    "contents": [
                    {
                        "type": "text",
                        "text": "สรงประภา",
                        "align": "center"
                    }
                    ],
                    "paddingAll": "md"
                }
                ]
            },
            {
                "type": "box",
                "layout": "vertical",
                "contents": [
                {
                    "type": "text",
                    "align": "center",
                    "text": `${configText[lang].units}`,
                    "color": "#FFFFFF"
                }
                ],
                "backgroundColor": "#FB2676",
                "paddingAll": "md"
            },
            {
                "type": "box",
                "layout": "horizontal",
                "contents": [
                {
                    "type": "box",
                    "layout": "vertical",
                    "contents": [
                    {
                        "type": "text",
                        "text": "413 ยูนิต",
                        "align": "center"
                    }
                    ],
                    "paddingAll": "md"
                },
                {
                    "type": "separator"
                },
                {
                    "type": "box",
                    "layout": "vertical",
                    "contents": [
                    {
                        "type": "text",
                        "text": "138 ยูนิต",
                        "align": "center"
                    }
                    ],
                    "paddingAll": "md"
                }
                ]
            },
            {
                "type": "box",
                "layout": "vertical",
                "contents": [
                {
                    "type": "text",
                    "align": "center",
                    "text": `${configText[lang].facility}`,
                    "color": "#FFFFFF"
                }
                ],
                "backgroundColor": "#FB2676",
                "paddingAll": "md"
            },
            {
                "type": "box",
                "layout": "vertical",
                "contents": [
                {
                    "type": "box",
                    "layout": "vertical",
                    "contents": [
                    {
                        "type": "text",
                        "align": "center",
                        "text": "1",
                        "color": "#6A6D75"
                    }
                    ],
                    "backgroundColor": "#F0F1F3",
                    "paddingAll": "md",
                    "borderColor": "#DBDBDB",
                    "borderWidth": "none"
                },
                {
                    "type": "box",
                    "layout": "horizontal",
                    "contents": [
                    {
                        "type": "box",
                        "layout": "vertical",
                        "contents": [
                        {
                            "type": "text",
                            "text": " ",
                            "align": "center"
                        }
                        ],
                        "paddingAll": "md"
                    },
                    {
                        "type": "separator"
                    },
                    {
                        "type": "box",
                        "layout": "vertical",
                        "contents": [
                        {
                            "type": "text",
                            "text": "✔️",
                            "align": "center"
                        }
                        ],
                        "paddingAll": "md"
                    }
                    ],
                    "borderColor": "#DBDBDB",
                    "borderWidth": "none"
                }
                ]
            }
            ],
            "paddingAll": "0px"
        },
        "footer": {
            "type": "box",
            "layout": "horizontal",
            "contents": [
            {
                "type": "box",
                "layout": "vertical",
                "contents": [
                {
                    "type": "button",
                    "action": {
                    "type": "uri",
                    "label": `${configText[lang].detile}`,
                    "uri": "http://linecorp.com/"
                    },
                    "color": "#FFFFFF"
                }
                ],
                "backgroundColor": "#FB2676"
            },
            {
                "type": "separator",
                "color": "#FFFFFF"
            },
            {
                "type": "box",
                "layout": "vertical",
                "contents": [
                {
                    "type": "button",
                    "action": {
                    "type": "uri",
                    "label": `${configText[lang].detile}`,
                    "uri": "http://linecorp.com/"
                    },
                    "color": "#FFFFFF"
                }
                ],
                "backgroundColor": "#FB2676"
            }
            ],
            "paddingAll": "0px"
        }
        }
    node.warn(bubble);
    // let lang = msg.payload.action.metadata.information.lang
    let even = ((index+1) % 2 === 0) ? true : false
    if (!even) {
        if((msg._unify_bot.metadata.information.length-1)==index){
            bubble = {
                "type": "bubble",
                "size": "giga",
                "body": {
                    "type": "box",
                    "layout": "vertical",
                    "contents": [
                        {
                            "type": "box",
                            "layout": "horizontal",
                            "contents": [
                                {
                                    "type": "box",
                                    "layout": "vertical",
                                    "contents": [
                                        {
                                            "type": "image",
                                            "url": "https://assets.sansiri.com/o77site/siri-place-charan-pinklao-townhouse-portrait-810x890.jpg",
                                            "size": "full",
                                            "aspectMode": "cover",
                                            "aspectRatio": "21:10.5"
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "type": "box",
                            "layout": "horizontal",
                            "contents": [
                                {
                                    "type": "box",
                                    "layout": "vertical",
                                    "contents": [
                                        {
                                            "type": "text",
                                            "text": "สิริ เพลส จรัญฯ - ปิ่นเกล้า",
                                            "size": "md",
                                            "wrap": true,
                                            "align": "center",
                                            "weight": "bold"
                                        }
                                    ],
                                    "alignItems": "center",
                                    "justifyContent": "center",
                                    "paddingTop": "10px",
                                    "paddingBottom": "10px"
                                }
                            ],
                            "margin": "none",
                            "borderColor": "#DBDBDB",
                            "borderWidth": "none"
                        },
                        {
                            "type": "separator"
                        },
                        {
                            "type": "box",
                            "layout": "horizontal",
                            "contents": [
                                {
                                    "type": "box",
                                    "layout": "vertical",
                                    "contents": [
                                        {
                                            "type": "text",
                                            "contents": [
                                                {
                                                    "type": "span",
                                                    "text": "เริ่มต้น "
                                                },
                                                {
                                                    "type": "span",
                                                    "text": "3.59",
                                                    "weight": "bold",
                                                    "color": "#FB2676"
                                                },
                                                {
                                                    "type": "span",
                                                    "text": " ล้านบาท"
                                                }
                                            ],
                                            "align": "center"
                                        }
                                    ],
                                    "margin": "none",
                                    "paddingAll": "md"
                                }
                            ],
                            "borderColor": "#DBDBDB",
                            "margin": "xs"
                        },
                        {
                            "type": "box",
                            "layout": "vertical",
                            "contents": [
                                {
                                    "type": "text",
                                    "text": `${configText[lang].location}`,
                                    "align": "center",
                                    "color": "#FFFFFF"
                                }
                            ],
                            "backgroundColor": "#FB2676",
                            "paddingAll": "md"
                        },
                        {
                            "type": "box",
                            "layout": "horizontal",
                            "contents": [
                                {
                                    "type": "box",
                                    "layout": "vertical",
                                    "contents": [
                                        {
                                            "type": "text",
                                            "text": "จรัญสนิทวงศ์",
                                            "align": "center"
                                        }
                                    ],
                                    "paddingAll": "md",
                                    "borderWidth": "light"
                                }
                            ]
                        },
                        {
                            "type": "box",
                            "layout": "vertical",
                            "contents": [
                                {
                                    "type": "text",
                                    "align": "center",
                                    "text": `${configText[lang].units}`,
                                    "color": "#FFFFFF"
                                }
                            ],
                            "backgroundColor": "#FB2676",
                            "paddingAll": "md"
                        },
                        {
                            "type": "box",
                            "layout": "horizontal",
                            "contents": [
                                {
                                    "type": "box",
                                    "layout": "vertical",
                                    "contents": [
                                        {
                                            "type": "text",
                                            "text": "413 ยูนิต",
                                            "align": "center"
                                        }
                                    ],
                                    "paddingAll": "md"
                                }
                            ]
                        },
                        {
                            "type": "box",
                            "layout": "vertical",
                            "contents": [
                                {
                                    "type": "text",
                                    "align": "center",
                                    "text": `${configText[lang].facility}`,
                                    "color": "#FFFFFF"
                                }
                            ],
                            "backgroundColor": "#FB2676",
                            "paddingAll": "md"
                        },
                        {
                            "type": "box",
                            "layout": "vertical",
                            "contents": [
                                {
                                    "type": "box",
                                    "layout": "vertical",
                                    "contents": [
                                        {
                                            "type": "text",
                                            "align": "center",
                                            "text": "1",
                                            "color": "#6A6D75"
                                        }
                                    ],
                                    "backgroundColor": "#F0F1F3",
                                    "paddingAll": "sm",
                                    "borderColor": "#DBDBDB",
                                    "borderWidth": "none"
                                },
                                {
                                    "type": "box",
                                    "layout": "horizontal",
                                    "contents": [
                                        {
                                            "type": "box",
                                            "layout": "vertical",
                                            "contents": [
                                                {
                                                    "type": "text",
                                                    "text": "✔️",
                                                    "align": "center"
                                                }
                                            ],
                                            "paddingAll": "md"
                                        }
                                    ],
                                    "borderColor": "#DBDBDB",
                                    "borderWidth": "none"
                                }
                            ]
                        }
                    ],
                    "paddingAll": "0px"
                },
                "footer": {
                    "type": "box",
                    "layout": "horizontal",
                    "contents": [
                        {
                            "type": "box",
                            "layout": "vertical",
                            "contents": [
                                {
                                    "type": "button",
                                    "action": {
                                        "type": "uri",
                                        "label": `${configText[lang].detile}`,
                                        "uri": "http://linecorp.com/"
                                    },
                                    "color": "#FFFFFF"
                                }
                            ],
                            "backgroundColor": "#FB2676"
                        }
                    ],
                    "paddingAll": "0px"
                }
            }
        }
        checkedFacility = []
        faciciltyDedup.forEach(function(facicilty) {
            let boxFarName = {
              "type": "box",
              "layout": "vertical",
              "contents": [
                {
                  "type": "text",
                  "align": "center",
                  "text": "1",
                  "color": "#6A6D75"
                }
              ],
              "backgroundColor": "#F0F1F3",
              "paddingAll": "md",
              "borderColor": "#DBDBDB",
              "borderWidth": "none"
            }
            let boxCompare = {
              "type": "box",
              "layout": "horizontal",
              "contents": [
                {
                  "type": "box",
                  "layout": "vertical",
                  "contents": [
                    {
                      "type": "text",
                      "text": " ",
                      "align": "center"
                    }
                  ],
                  "paddingAll": "md"
                },
                {
                  "type": "separator"
                },
                {
                  "type": "box",
                  "layout": "vertical",
                  "contents": [
                    {
                      "type": "text",
                      "text": "✔️",
                      "align": "center"
                    }
                  ],
                  "paddingAll": "md"
                }
              ],
              "borderColor": "#DBDBDB",
              "borderWidth": "none"
            }
            if((msg._unify_bot.metadata.information.length-1)==index){
                boxCompare = {
                "type": "box",
                "layout": "horizontal",
                "contents": [
                    {
                    "type": "box",
                    "layout": "vertical",
                    "contents": [
                        {
                        "type": "text",
                        "text": "✔️",
                        "align": "center"
                        }
                    ],
                    "paddingAll": "md"
                    }
                ],
                "borderColor": "#DBDBDB",
                "borderWidth": "none"
                }
            }
            // boxFarName.contents[0].text = facicilty.facilityCategory
            boxFarName.contents[0].text = `${configText[lang]?.facilityProjectCategoryId[facicilty.facilityProjectCategoryId]}` || " "
            checkedFacility.push(boxFarName)
            let someFind = element.facility.some(far => far.facilityProjectCategoryId == facicilty.facilityProjectCategoryId)
            if(someFind){
                boxCompare.contents[0].contents[0].text = "✔️"
            }else{
                boxCompare.contents[0].contents[0].text = " "
            }
            checkedFacility.push(boxCompare)
        });
        bubble.body.contents[0].contents[0].contents[0].url = element.image
        bubble.body.contents[1].contents[0].contents[0].text = element.projectFullName
        bubble.body.contents[3].contents[0].contents[0].contents[1].text = `${element.minPrice}`
        bubble.body.contents[5].contents[0].contents[0].text = `${element.location}`
        bubble.body.contents[7].contents[0].contents[0].text = `${element.totalUnit} ${configText[lang].unit}`
        bubble.body.contents[9].contents = checkedFacility
        bubble.footer.contents[0].contents[0].action.uri = element.url
        contents.push(bubble)
    }else{
        bubble = contents[contents.length -1]
        bubble.body.contents[0].contents[1].contents[0].url = element.image
        bubble.body.contents[1].contents[1].contents[0].text = element.projectFullName
        bubble.body.contents[3].contents[2].contents[0].contents[1].text = `${element.minPrice}`
        bubble.body.contents[5].contents[2].contents[0].text = `${element.location}`
        bubble.body.contents[7].contents[2].contents[0].text = `${element.totalUnit} ${configText[lang].unit}`
        bubble.footer.contents[2].contents[0].action.uri = element.url
        faciciltyDedup.forEach(function(facicilty,index) {
            if (facicilty.facilityProjectCategoryId) {
                let someFind = element.facility.some(far => far.facilityProjectCategoryId == facicilty.facilityProjectCategoryId)
                if(someFind){
                    checkedFacility[((index + 1) * 2) - 1].contents[2].contents[0].text = "✔️"
                }else{
                    checkedFacility[((index + 1) * 2) - 1].contents[2].contents[0].text = " "
                }
            }
        });
    }
    // if (lang == "EN") {
    //   bubble.body.contents[2].contents[0].text = locale.en.projectDetails
    //   bubble.body.contents[2].contents[1].contents[0].contents[0].text = locale.en.floor1
    //   bubble.body.contents[2].contents[1].contents[1].contents[0].text = locale.en.floor2
    //   bubble.body.contents[3].contents[0].text = locale.en.usableArea
    //   bubble.body.contents[3].contents[1].text = `${element.size} ${locale.en.squareMeters}`
    //   bubble.body.contents[3].contents[2].contents[0].contents[0].text = locale.en.bedrooms
    //   bubble.body.contents[3].contents[3].contents[0].contents[0].text = locale.en.bathrooms
    //   bubble.body.contents[3].contents[4].contents[0].contents[0].text = locale.en.parking
    //   bubble.body.contents[3].contents[2].contents[1].contents[0].text = `${element.bedroom} ${locale.en.bedrooms}`
    //   bubble.body.contents[3].contents[3].contents[1].contents[0].text = `${element.bathroom} ${locale.en.bathrooms}`
    //   bubble.body.contents[3].contents[4].contents[1].contents[0].text = `${element.carPark.toString()} ${locale.en.vehicle}`
    //   bubble.footer.contents[0].action.label = `${locale.en.moreDetails}`
    //   bubble.footer.contents[0].action.uri = `${msg.payload.action.metadata.information.url}`
    // }
    // if (lang == "CN") {
    //   bubble.body.contents[2].contents[0].text = locale.cn.projectDetails
    //   bubble.body.contents[2].contents[1].contents[0].contents[0].text = locale.cn.floor1
    //   bubble.body.contents[2].contents[1].contents[1].contents[0].text = locale.cn.floor2
    //   bubble.body.contents[3].contents[0].text = locale.cn.usableArea
    //   bubble.body.contents[3].contents[1].text = `${element.size} ${locale.cn.squareMeters}`
    //   bubble.body.contents[3].contents[2].contents[0].contents[0].text = locale.cn.bedrooms
    //   bubble.body.contents[3].contents[3].contents[0].contents[0].text = locale.cn.bathrooms
    //   bubble.body.contents[3].contents[4].contents[0].contents[0].text = locale.cn.parking
    //   bubble.body.contents[3].contents[2].contents[1].contents[0].text = `${element.bedroom} ${locale.cn.bedrooms}`
    //   bubble.body.contents[3].contents[3].contents[1].contents[0].text = `${element.bathroom} ${locale.cn.bathrooms}`
    //   bubble.body.contents[3].contents[4].contents[1].contents[0].text = `${elememetadatant.carPark.toString()} ${locale.cn.vehicle}`
    //   bubble.footer.contents[0].action.label = `${locale.cn.moreDetails}`
    //   bubble.footer.contents[0].action.uri = `${msg.payload.action.metadata.information.url}`
    // }

});
msg.bubble = contents
return msg;